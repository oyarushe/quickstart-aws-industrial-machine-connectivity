//This document is the ASCII DOC version of the "IMC - Virtual Deployment User Guide" word document found in the IMC Quick Start Github repo (URL: https://github.com/aws-quickstart/quickstart-aws-industrial-machine-connectivity/blob/master/documentation/IMC%20-%20Virtual%20Deployment%20User%20Guide.docx)

=== Virtual Deployment Guide

==== Introduction:
The virtual deployment is intended for demonstration, training and evaluation of the IMC Quick Start’s capabilities. EC2 instances will be launched to simulate edge gateway hardware but in all other respects the experience will mirror that of the real physical deployment. This deployment mode relies on simulated tag values generated by the partner edge software. There are no physical PLCs or sensors that are being connected.

==== Deployment Options:
There are several options for the virtual deployment configuration which depend on 2 configuration choices:

. Data Flow option - There are 3 options for data flow:
- Option 1
- Option 2a
- Option 2b
. Ignition Server Tag Hierarchy Source
- Cirrus Link Module: This option is based on the Cirrus Link MQTT Transmission Module implementing the SparkplugB MQTT spec to publish birth certificates when a node or device is created within the Ignition Designer UI dashboard. The AMC runs automatically without a manual step with this option and results in assets provisioned within AWS IoT SiteWise.
- Ignition File Export - This option is based on exporting a JSON tag hierarchy definition file from Ignition Server and uploading it into an S3 bucket. Once the file is uploaded to the S3 bucket, the AMC runs automatically, resulting in assets provisioned within AWS IoT SiteWise.

Depending on the choices of these 2 configuration options, there are a total of 6 deployment modes:

. Virtual Option 1 Cirrus Link Module 
. Virtual Option 1 Ignition File Export  
. Virtual Option 2a Cirrus Link Module
. Virtual Option 2a Ignition File Export
. Virtual Option 2b Cirrus Link Module 
. Virtual Option 2b Ignition File Export

==== Getting Started

. Ensure you have completed the pre-requisites detailed in the link:pre-reqs.adoc[Prepare for Deployment] section.
. Ensure you are launching the CloudFormation stack in one of the 3 supported regions for the IMC Quick Start:
- us-east-1
- us-west-2
- eu-west-1
- eu-central-1

. Select one of the 6 deployment modes from the "Deployment Modes" list above and follow these sections:
.. CloudFormation stack launch
.. Post deployment steps

==== References:
Refer to the following sections as needed:

- Troubleshooting - Refer to this section to troubleshoot IMC stack launch and operation.
- Virtual Cleanup - Refer to this section to cleanup AWS resources launched for the IMC Quick Start.
- Virtual Deployment FAQ - Refer to this section for FAQs regarding IMC Quick Start.

==== CloudFormation Stack Launch
To launch the virtual deployment of the IMC Quick Start, open up the AWS Console and navigate to the CloudFormation console. Create a new stack and select “with new resources (standard)”). 

===== Step 1: Specify templates

* Pre-Requisite:
** Select “Template is ready”
* Specify Template (Choose one of the below):
** Template Source: Leave as default – “Amazon S3 URL”. Most users will want to use the “IMC-main.template.yaml” CloudFormation master template that’s in the AWS Quick Start S3 bucket. The full S3 URL for the master template is:
*** Master Template S3 URL: https://aws-quickstart.s3.amazonaws.com/quickstart-aws-industrial-machine-connectivity/templates/IMC-main.template.yaml
*** This template launches the solution in a new VPC. Note, only 5 VPCs per account are permitted. 
** Alternatively, launch the “IMC-workload.template.yaml” Cloudformation template. The workload template launches the solution in your default VPC. 
*** Workload Template S3 URL: https://aws-quickstart.s3.amazonaws.com/quickstart-aws-industrial-machine-connectivity/templates/IMC-workload.template.yaml
* Click Next to proceed to Step 2 of the CloudFormation stack launch (Specify stack details)

===== Step 2 – Specify Stack Details (if using master template)

* Stack Name: 
** Stack Name: Give the stack a unique name such as “IMC-Virtual”
* Parameters
** Network Configuration
*** VPC CIDR: Defaults to 10.0.0.0/16. Change if desired
	Public subnet 1 CIDR: Defaults to 10.0.128.0/20. Change if desired
	VPC Tenancy: Defaults to non-dedicated. Change if desired.
o	AWS Quick Start Configuration
	QuickStart S3 Bucket Name: aws-quickstart
	QuickStart S3 Key Prefix: quickstart-aws-industrial-machine-connectivity/
	QuickStart S3 Bucket Region: Suggested to leave as default “us-east-1”
o	Edge Deployment Configuration
	Name for the edge device: You may leave as default or, if desired, you may specify a new name for the edge device. This name will be the name of the Greengrass group that gets created with this stack.
	Type of Deployment (Virtual or Physical): Virtual
	Deployment Flow: Select “Option 1”. 

o	Amazon EC2 Configuration
	SSH Key Name: Select your SSH Key Name (EC2 Key Pair). This is the Key Pair used to SSH into the EC2 instances and bootstrap the partner edge software application and AWS IoT Greengrass, respectively.
	Greengrass EC2 Instance Type: (default: t3.small) You can select a larger (t3.medium) instance if desired. It is suggested you leave the as the default value.
	Ignition EC2 Instance Types: (default: t3.large) You can select a larger (t3.xlarge) instance if desired. It is suggested you leave the as the default value.
	Select the Asset Model Converter (AMC) Driver: Leave as default “IgnitionCirrusLink”. 
	User Public IP Address: Input your public IP address in the format “x.x.x.x” so the EC2 instance security groups allow access from your IP address.


.TABLE DESCRIPTION
|===
|Parameter label (name) |Default Value |Description

// Space needed to maintain table headers
|VPC CIDR |10.0.0.0/16 |TEST
|X |X |X
|X |X |X
|X |X |X


|===

